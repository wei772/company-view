<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
    <preConditions>
        <dbms type="postgresql"/>
    </preConditions>

    <changeSet id="1" author="frozbit">
        <comment>Date created: 15.03.2015, built on top of postgres 9.4</comment>
        <sql>
            CREATE TABLE KontoStaatus (
                kontoStaatusID SERIAL PRIMARY KEY,
                nimetus TEXT NOT NULL
            );

            CREATE TABLE KasutajaTyyp (
                kasutajaTyypID SERIAL PRIMARY KEY,
                nimetus TEXT NOT NULL
            );

            CREATE TABLE KontoSyndmuseTyyp (
                kontoSyndmuseTyypID SERIAL PRIMARY KEY,
                nimetus TEXT NOT NULL
            );

            CREATE TABLE Kasutaja (
                kasutajaID SERIAL PRIMARY KEY,
                kasutajaTyypID INT NOT NULL REFERENCES KasutajaTyyp(kasutajaTyypID),
                kontoStaatusID INT NOT NULL REFERENCES KontoStaatus(kontoStaatusID),
                aadress TEXT NOT NULL,
                eesnimi TEXT NOT NULL,
                email TEXT NOT NULL,
                konto_nimi TEXT NOT NULL,
                matrikli_kood TEXT,
                organisatsiooni_nimi TEXT,
                parool TEXT NOT NULL,
                perekonnanimi TEXT NOT NULL,
                tel_nr TEXT NOT NULL
            );

            CREATE TABLE KontoSyndmus (
                kontoSyndmusID SERIAL PRIMARY KEY,
                kontoSyndmuseTyypID INT NOT NULL REFERENCES KontoSyndmuseTyyp(kontoSyndmuseTyypID),
                kasutajaID INT NOT NULL REFERENCES Kasutaja(kasutajaID),
                vana_staatus INT NOT NULL REFERENCES KontoStaatus(kontoStaatusID),
                uus_staatus INT NOT NULL REFERENCES KontoStaatus(kontoStaatusID),
                loodud TIMESTAMP NOT NULL
            );

            INSERT INTO KontoStaatus (nimetus) VALUES ('inactive');
            INSERT INTO KontoStaatus (nimetus) VALUES ('banned');
            INSERT INTO KontoStaatus (nimetus) VALUES ('active');

            INSERT INTO KasutajaTyyp (nimetus) VALUES ('company');
            INSERT INTO KasutajaTyyp (nimetus) VALUES ('student');
            INSERT INTO KasutajaTyyp (nimetus) VALUES ('university staff');

            INSERT INTO KontoSyndmuseTyyp (nimetus) VALUES ('account creation');
            INSERT INTO KontoSyndmuseTyyp (nimetus) VALUES ('account banning');
            INSERT INTO KontoSyndmuseTyyp (nimetus) VALUES ('account unbanning');
            INSERT INTO KontoSyndmuseTyyp (nimetus) VALUES ('account deactivation');
            INSERT INTO KontoSyndmuseTyyp (nimetus) VALUES ('account activation');
        </sql>
    </changeSet>
</databaseChangeLog>